<footer *ngIf="state$ | async as state" [class.blocked]="!state.canPlay" class="now-playing-bar surface-card border-round-md">
  <div class="tooltip-blocked">Select a song to play</div>
  <div class="now-playing-bar-content">
    <div class="left">
      <div #songInfo class="left-content">
        <div class="image-wrapper">
          <img [src]="playbackState()?.song?.photoUrl" alt="">
        </div>
        <div>
          <div class="flex gap-2 flex-column">
            <span class="font-medium"><a routerLink="/">{{playbackState()?.song?.name}}</a></span>
            <span class="text-sm"><a style="--text-color: var(--surface-500)" routerLink="/">{{playbackState()?.song?.artist?.displayName}}</a></span>
          </div>
          <p-contextMenu [target]="songInfo" [model]="items()" appendTo="body"></p-contextMenu>
        </div>
      </div>
    </div>
    <div class="center">
      <div class="controls">
        <div class="controls-left">
          <p-button [text]="true" styleClass="p-2">
            <span class="icon-wrapper" style="--size: 16px">
              <svg data-encore-id="icon" role="img" aria-hidden="true" viewBox="0 0 16 16">
                <path d="M13.151.922a.75.75 0 1 0-1.06 1.06L13.109 3H11.16a3.75 3.75 0 0 0-2.873 1.34l-6.173 7.356A2.25 2.25 0 0 1 .39 
                12.5H0V14h.391a3.75 3.75 0 0 0 2.873-1.34l6.173-7.356a2.25 2.25 0 0 1 1.724-.804h1.947l-1.017 1.018a.75.75 0 0 0 1.06 
                1.06L15.98 3.75 13.15.922zM.391 3.5H0V2h.391c1.109 0 2.16.49 2.873 1.34L4.89 5.277l-.979 1.167-1.796-2.14A2.25 2.25 0 0 0 .39 3.5z"></path>
                <path d="m7.5 10.723.98-1.167.957 1.14a2.25 2.25 0 0 0 1.724.804h1.947l-1.017-1.018a.75.75 0 1 1 1.06-1.06l2.829 
                2.828-2.829 2.828a.75.75 0 1 1-1.06-1.06L13.109 13H11.16a3.75 3.75 0 0 1-2.873-1.34l-.787-.938z"></path>
              </svg>
            </span>
          </p-button>
          <p-button icon="pi pi-step-backward" [text]="true" styleClass="p-2"></p-button>
        </div>
        @if (state.playing) {
          <p-button [rounded]="true" icon="pi pi-pause" (onClick)="onPause()"></p-button>
        } @else {
          <p-button [rounded]="true" icon="pi pi-play" (onClick)="onPlay()"></p-button>
        }
        <div class="controls-right">
          <p-button icon="pi pi-step-forward" [text]="true" styleClass="p-2"></p-button>
          <p-button [text]="true" styleClass="p-2">
            <span class="icon-wrapper" style="--size: 16px">
              <svg data-encore-id="icon" role="img" aria-hidden="true" viewBox="0 0 16 16">
                <path d="M0 4.75A3.75 3.75 0 0 1 3.75 1h8.5A3.75 3.75 0 0 1 16 4.75v5a3.75 3.75 0 0 1-3.75 3.75H9.81l1.018 1.018a.75.75 0 1 1-1.06 
                1.06L6.939 12.75l2.829-2.828a.75.75 0 1 1 1.06 1.06L9.811 12h2.439a2.25 2.25 0 0 0 2.25-2.25v-5a2.25 2.25 0 0 0-2.25-2.25h-8.5A2.25 
                2.25 0 0 0 1.5 4.75v5A2.25 2.25 0 0 0 3.75 12H5v1.5H3.75A3.75 3.75 0 0 1 0 9.75v-5z"></path>
              </svg>
            </span>
          </p-button>
        </div>
      </div>
      <div class="playbar flex gap-2 align-items-center">
        <div>
          <span class="text-xs select-none pointer-events-none">{{state.redableCurrentTime}}</span>
        </div>
        <div class="flex-1">
          <app-draggable-bar [maxValue]="state.duration" [value]="state.currentTime" (valueChanged)="onPlayingBarValueChange($event)"></app-draggable-bar>
        </div>
        <div>
          <span class="text-xs select-none pointer-events-none">{{state.readableDuration}}</span>
        </div>
      </div>
    </div>
    <div class="right">
      <div class="right-content">
        <div class="volume-wrapper">
          <p-button (onClick)="toggleMute()" [text]="true" [icon]="state.muted ? 'pi pi-volume-off' : state.volume <= 50 ? 'pi pi-volume-down' : 'pi pi pi-volume-up'"></p-button>
          <div class="flex-1">
            <app-draggable-bar [maxValue]="100" [live]="true" [value]="state.volume" (valueChanged)="onVolumeValueChange($event)"></app-draggable-bar>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>